{
  
    
        "post0": {
            "title": "Multi-Label Auto-Tagging of Audio Files Using fastai2 Audio - Part 1 - Definition and Data",
            "content": "Welcome to part 1 of a blog series based on my Udacity Machine Learning Engineer Nanodegree Capstone project. This initial section deals with the problem definition, outlines the solution approach using the in-development fastai2 audio library and discusses the dataset. . The blog series will be structured as follows: . Problem Definition, Proposed Solution and Data Exploration | Implementation | Results and Analysis | Links will be provided as the series progresses. Please see the associated GitHub repository for all notebooks, please contact me with any queries. . I. Problem Definition . Overview . The sub-field of Machine Learning known as Machine Listening is a burgeoning area of research using signal processing for the automatic extraction of information from sound by a computational analysis of audio. There are many different areas of research within this field as demonstrated by the latest Detection and Classification of Acoustic Scenes and Events (DCASE) 2020 Challenge1, a machine learning challenge dedicated to the research and development of new methods and algorithms for audio. These include: . Acoustic Scene Classification | Sound Event Detection and Localization | Sound Event Detection and Separation in Domestic Environments | Urban Sound tagging | Automated Audio Captioning | . As an acoustic engineer, I am extremely intrigued by this new field. Recent developments in machine learning algorithms have allowed significant progress to be made within this area, with the potential applications of the technology being wide and varied and meaning the tools could prove to be extremely useful for the acoustic practitioner amongst many other uses. . The in-development user-contributed fast.ai2 Audio library2 inspired me to undertake the development of a deep learning audio-tagging system for this Udacity Capstone project, described herein. . Problem Statement . The Freesound Audio Tagging 2019 Kaggle Competition provides the basis for my research project3. . The challenge is to develop a system for the automatic classification of multi-labelled audio files within 80 categories, that could potentially be used for automatic audio/video file tagging with noisy or untagged audio data. This has historically been investigated in a variety of ways: . Conversion of audio to mel-spectrogram images fed into CNNs | End-to-End Deep learning | Custom architectures involving auto-encoders | Features representation transfer learning with custom architectures and Google’s Audioset | . In addition, the classification of weakly labelled data from large-scale crowdsourced datasets provides a further problem for investigation4. The problem is clearly quantifiable in that a number of accuracy metrics could be used to quantify the accuracy of the model’s predictions, described below. . The competition dataset comprises audio clips from the following existing datasets: . “Curated Train Set” - Freesound Dataset (FSD): a smaller dataset collected at the MTG-UPF based on Freesound content organized with the AudioSet Ontology and manually labelled by humans. 4964 files. | “Noisy Train Set” - The soundtracks of a pool of Flickr videos taken from the Yahoo Flickr Creative Commons 100M dataset (YFCC) which are automatically labelled using metadata from the original Flickr clips. These items therefore have significantly more label noise than the Freesound Dataset items. 19815 files. | . The data comprises 80 categories labelled according to Google’s Audioset Ontology 3 with ground truth labels provided at the clip level. The clips range in duration between 0.3 to 30s in uncompressed PCM 16 bit, 44.1 kHz mono audio files. . Solution Statement . With the above competition requirements in mind, the proposed solution was followed and was undertaken initially within a Pytorch AWS SageMaker notebook instance using Jupyter Notebooks, and further, using a Google Cloud Platform AI Notebook using fastai2 and fastai2 audio libraries , due to the extra credits required for the long training times on a GPU instance: . The data will be downloaded from Kaggle into the chosen platform AWS SageMaker / GCP AI Notebook instance | Exploratory Data Analysis - The dataset will be downloaded such that the file metadata can be extracted, in order to confirm: sample rates, bit-rates, durations, channels (mono/stereo) for each file in order to direct initial signal processing stage and approach towards the dataset splitting. In addition, the statistics of the file labels will be analysed. | Model Development: The fastai2 and fastai2 audio libraries will be installed | The fastai2 audio library will be used for the data processing, in order to convert the audio files into tensor representations of mel-spectrograms on-the-fly, rather than in a separate pre-processing stage. This is a significant benefit of the library in terms of allowing quick experimentation and iteration within the model development over other methods such as converting all audio files to mel-spectrogram images separately. | In-line with the competition rubric, a non-pretrained convolutional neural network (CNN) using the fastai2 library for PyTorch will be developed using state-of-the-art methods and additions. | The model will be trained on the “Noisy Train Set” in a 5-Folds Cross Validation manner, using Sci-Kit Learn’s K-Fold model selection module5, for a shorter period due to the large amount of data. | The results of these 5 models will be used to train on the “Curated Train Set” in the same 5-Folds Cross Validation manner as the noisy train set, but for a longer period. | Test-Time-Augmentation (TTA) will be used to gain averaged predictions from all 5 final models on the test set. The predictions will be submitted as a Late-Submission for the analysis of the results. | This will be repeated, with tweaks to the model augmentations in order to try to improve the results iteratively. | . | Metrics . Due to the advancement of multi-label audio classification in recent years, a simple multi-label accuracy metric was not used within the Kaggle competition, as performances of the systems can easily exceed 95% within a few epochs of training. . As such, the competition used label-weighted label-ranking average precision (a.k.a lwl-rap) as the evaluation metric. The basis for the metric, the label-ranking average precision algorithm, is described in detail within the Sci-Kit Learn implementation6. The additional adaptations of the metric are to provide the average precision of predicting a ranked list of relevant labels per audio file, which is a significantly more complex problem to solve than a standard multi-label accuracy metric. The overall score is the average over all the labels in the test set, with each label having equal weight (rather than equal weight per test item), as indicated by the “label-weighted” prefix. This is defined as follows7: . lwlrap=1∑s∣C(s)∣∑a∑eϵ C(s)Prec(s,c)lwlrap = frac{1}{ sum_{s} left | C(s) right |} sum_{a} sum_{e epsilon C(s)}Prec(s,c)lwlrap=∑s​∣C(s)∣1​a∑​eϵ C(s)∑​Prec(s,c) . where Prec(s,c)Prec(s,c)Prec(s,c) is the label-ranking precision for the list of labels up to class ccc and the set of ground-truth classes for sample sss is C(s)C(s)C(s). $$ | C(s) | isthenumberoftrueclasslabelsforsampleis the number of true class labels for sampleisthenumberoftrueclasslabelsforsamples$$. | . The Kaggle competition provides a Google Colab example implementation8. . II. Analysis . Data Exploration . The datasets were downloaded from Kaggle using the Kaggle API and analysed within a Jupyter Notebook. . The first stage of the process was to understand the dataset more fully. Fortunately, due to being a Kaggle Competition dataset it was well documented and clean in terms of organization. . Downloading the dataset was undertaken using guidance given within the Kaggle Forums9 directly into the SageMaker/GCP Instance storage for easy access. . The files were then unzipped for the EDA. For further details, please see the notebook directly. . Pandas and Pandas Profiling . In order to undertake the analysis of the data, the numerical data analysis packages Pandas and Pandas Profiling were used. . Pandas Profiling10 is an extremely useful add-on package to Pandas, which creates HTML profile reports directly from Pandas DataFrames quickly and easily. From the provided .csv files file category labels were analysed and, in addition, the audio file meta-data was extracted (i.e. sample rates, bit-rates, durations, number of channels). . ![]( . ​ Fig 1. An example Pandas DataFrame of extracted audio file info . Using these two packages the following was found: . Curated Train Data . For the Curated Train dataset, it was found that the bit-rate was a constant 16bits, the channels a constant 1 (mono), constant sample rate of 44100kHz and that there were 213 different tagging combinations of the 80 audio labels over the total file count (4964 files): . ![]( . ​ Fig 2. Pandas Profiling for the Curated Train Data set . In terms of the file durations, the average file length was 7.63 seconds and the files ranged between just over 0 and 30 seconds long, with the lengths predominantly in the 0-5 seconds length range. This will affect the mel-spectrogram processing of the data, i.e. we will need to ensure a sufficient amount of both the longer and smaller audio files are taken, in order for the feature learning of the CNN to be accurate. . ![]( . ​ Fig 3. Pandas Profiling information for the audio file durations . Noisy Train Data . As with the Curated dataset, with the Noisy Train dataset it was found that the bit-rate was a constant 16bits, the channels a constant 1 (mono), constant sample rate of 44100kHz. However, in this dataset there were 1168 different tagging combinations of the 80 audio labels over the total file count (19815 files): . ![]( . ​ Fig 4. Pandas Profiling for the Noisy Train dataset . The Noisy Train dataset average file length was significantly longer on average than the Curated set at 14.6s long, however, the files ranged between 1 and 16 seconds long. There is therefore a significant difference in terms of length between the two datasets. . ![]( . ​ Fig 5. Pandas Profiling information for the audio file durations . In addition, as the name implies, the Noisy Train set files have a significantly higher noise floor than the Curated Train set due to the provenance of the files. . Data Visualisation . The following figure clearly illustrates the differences between the difference in durations of audio files between the two datasets: . ![]( . ​ Fig 6. Train vs Noisy dataset durations (x-axis = seconds) . Therefore, in the development of the model the following factors will need to be considered: . Noise floor differences between the curated and noisy train set will affect how the signals are clipped to shorter lengths to feed into the CNN. | The average lengths also have a high range of values both over the the individual datasets and between the curated and noisy set, we will need to ensure the main recorded features corresponding to the file labels of each recording are kept within any clipped sections to produce the mel-spectrograms. | . Algorithms and Techniques . Mel-Spectrograms . This signal processing stage will involve trimming (to ensure uniform duration) in order be converted to uniform length log-mel-spectrogram representations of the audio. A log-mel-spectrogram is a spectrogram representation of the audio i.e. a frequency-domain representation based on the Fourier Transform, with x-axis = time, y axis = frequency and colour depth/pixel value = relative sound intensity, which has been has been converted to the Mel scale on the y-axis by a non-linear transform in order to be more representative of the highly non-linear magnitude and frequency sensitivities of the human ear11. The chosen settings will be discussed and shown further in the Data Preprocessing section. . ![]( . ​ Fig 7. Conversion from Waveform to Mel-spectrogram representation . Convolutional Neural Network (CNN) . The length uniformity of the audio clips in is important, as it allows 2D tensors of the mel-spectrograms to be fed in batches into a CNN. The model variety used was as follows, based on the state of the art findings of the fastai community12 and other research described below. The model and architecture used the following settings: . Architecture: fastai2’s XResNet50 based on the Bag of Tricks13 research paper which includes tweaks to the optimisation methods for higher performance. ResNets use skip connections in order to allow propagation of information more deeply into the architecture, giving significant speed improvements for deeper networks and allowing the gradient descent to backpropagate through the network which aids in increasing training accuracy. This has further been augmented in the Bag of Tricks paper, whereby the residual block convolutional layers have been re-arranged such that further efficiency gains are made. . | Activation Function: Mish14 which has been shown to provide performance improvements over the standard ReLU activation function due to its smoothing of the activations rather than the cut-off of the ReLU function for values below 0. | Optimizer Function: Ranger which is a combination of the RAdam15 and Lookahead16 optimizer functions. These functions work as a searching pair, whereby one learner goes ahead of the other to explore the function topography, such that traps involving local minima can be avoided. | Layer tweaks: Self-Attention Layers17 | Replacing Max Pooling Layers with “MaxBlurPool” layers for better generalization | Flat-Cosine decay learning rate scheduling | . K-Folds Validation . Sci-Kit Learn’s KFolds Validation function was used to split the datasets into 5 folds, to allow all of the available data to be used in the training and to further allow the 5 created models to give ensembled predictions on the Test set, which provides a significant performance improvement over a single model. . MixUP . MixUp, whereby two spectrograms are combined to form a third, was also used during the longer Curated Training Set procedure. Detailed further below. . Test-Time Augmentation (TTA) . In addition to the methods outlined above, Test-Time augmentations were applied to the test set, such that the data transformations were used as part of the testing procedure in order to give a further performance boost. . Benchmark . The Baseline performance for the Kaggle Competition was set at 0.53792 which provided a minimum target. The winner18 of the competition acheived 0.75980, which provided the upper target. The details of the winning model and training method can be found on the linked GitHub page, but for brevity, the basic details of the system from the GitHub repo, were as follows: . Log-scaled mel-spectrograms | CNN model with attention, skip connections and auxiliary classifiers | SpecAugment, Mixup augmentations | Hand relabeling of the curated dataset samples with a low score | Ensembling with an MLP second-level model and a geometric mean blending | . Up Next . In Part 2 of this blog series, we will look at the methodology and implementation of training the model and improving it iteratively. . http://dcase.community/challenge2020/index &#8617; . | https://github.com/rbracco/fastai2_audio &#8617; . | https://www.kaggle.com/c/freesound-audio-tagging-2019/overview ↩ &#8617; &#8617;2 . | Learning Sound Event Classifiers from Web Audio with Noisy Labels - Fonseca et al. 2019 https://arxiv.org/abs/1901.01189 &#8617; . | https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.KFold.html &#8617; . | https://scikit-learn.org/stable/modules/model_evaluation.html#label-ranking-average-precision) &#8617; . | Fonseca et al. - Audio tagging with noisy labels and minimal supervision. In Proceedings of DCASE2019 Workshop, NYC, US (2019). URL: https://arxiv.org/abs/1906.02975 ↩ ↩ ↩ ↩ ↩ &#8617; . | (https://colab.research.google.com/drive/1AgPdhSp7ttY18O3fEoHOQKlt_3HJDLi8) &#8617; . | https://www.kaggle.com/c/deepfake-detection-challenge/discussion/129521) &#8617; . | https://github.com/pandas-profiling/pandas-profiling &#8617; . | Computational Analysis of Sound Scenes and Events, pg. 22 - Virtanen et al. &#8617; . | https://github.com/muellerzr/Practical-Deep-Learning-for-Coders-2.0/blob/master/Computer%20Vision/04_ImageWoof.ipynb &#8617; . | He, Tong, Zhi Zhang, Hang Zhang, Zhongyue Zhang, Junyuan Xie, and Mu Li. 2018. “Bag of Tricks for Image Classification with Convolutional Neural Networks.” CoRR abs/1812.01187 &#8617; . | Misra, Diganta. 2019. “Mish: A Self Regularized Non-Monotonic Neural Activation Function.” &#8617; . | Liyuan Liu et al. 2019 - On the Variance of the Adaptive Learning rate and Beyond &#8617; . | Zhang, Lucas Hinton, Ba - Lookahead Optimizer: k steps forward, 1 step back &#8617; . | Han Zhang, Ian Goodfellow, Dimitris Metaxas, Augustus Odena 2018 - Self-Attention Generative Adversarial Networks &#8617; . | https://github.com/lRomul/argus-freesound &#8617; . |",
            "url": "https://mikful.github.io/mike-blog/markdown/fastai2/audio/machine%20learning/2020/06/05/Udacity-Capstone-Part-1-Definition-and-Data.html",
            "relUrl": "/markdown/fastai2/audio/machine%20learning/2020/06/05/Udacity-Capstone-Part-1-Definition-and-Data.html",
            "date": " • Jun 5, 2020"
        }
        
    
  

  
  

  
      ,"page1": {
          "title": "Learning How to Learn - Part 1",
          "content": "As a lifelong learner, one thing you may come to ask yourself is: . “What’s the best way to learn? And why wasn’t I taught it?” . It seems to me that formal education provides us with little option other than to tackle this problem in our own way, with limited knowledge of how memory, concentration or the brain in general functions. This leads us to, more often than not, stumble into our own method of intaking, digesting and retaining information. In most cases this is likely formed out of habit, rather than design, which is surely a waste of mental potential. . Having recently decided to undertake further study at post-graduate level, I have become very interested in maximising my mental capacity and this has lead to to discover a few fascinating resources on meta-learning: . Learning How to Learn (Coursera) | Jim Kwik’s Kwik Brain Podcast | These posts will discuss what I have learned from the former Coursera course for the time being. . Learning How to Learn - Week 1 - What is Learning? . Modes of Thinking . The course starts with an introduction to what modes of thinking are present during the learning process. These can be described as: . Focused | Diffuse | . The Focused Mode refers to the analytical, focused mode whereby we are using familiar relations and known entities to work through a problem, or produce a specific outcome. It’s the technical adviser. . The Diffuse Mode refers to that broader, open state of mind, whereby we are making new connections and having a “big picture” perspective. It’s the creative. . However, here’s the crux of it: We can’t be in both modes at the same time. . When learning something new, we need to be able to switch between these modes in order to focus intently, take in information and relate it to what we already know and then further synthesize this information during periods of free thought. It’s like working out - you can’t keep busting reps forever, you’ll do yourself damage before long. Instead, you need to focus intently, do the reps and then allow your body to recover and grow muscles, or in this case - synapses. . Einstein famously relied on “creative play” in his thought experiments to come up with his greatest work. . What’smore, Dali and Edison both used a similar trick, which was critical to their creativity - that is, relax into a chair and allow your mind to go blank, but while holding an object (e.g. ball bearings/a watch), then at the moment at which you almost fall asleep and the objects fall out of your hand onto the floor - bingo! Hello Diffuse Mode. . At that point, they would have entered the free-associative mode and could come up with interesting new takes on their work or the problem. So here comes the first interesting aspect of sleep… . Upgrading Your Brain . There are a few ways we can improve our mental performance: . Sleep | Exercise | Stimulating Environment | . Sleep . Sleep is like giving your mind an upgrade. It is perhaps the most important aspect in all of our mental and physical health: “Why We Sleep” gives a fascinating insight into the huge array of processes that are both helped and hindered by a sufficient amount or lack thereof sleep… my main take away from this book was: “SLEEEEEEEEEEP!”. A more than worthy lesson in a world that still seems to have a universally outdated approach to work (where I live, they say: “El que madruga coge la oruga”), a terrible caffeine addiction and all the while a mobile phone blasting blue-light into our retinas. . During the learning process, even just 24hours later after sleep, new synapses form along the dendrites of neurons. It’s a remarkable process really. . In addition, sleep clears out toxic plaque from between the brain cells - your brain cells literally shrink and allow this to happen. Without sleep, nope. . In addition, during the deeper phases of sleep, the brain is literally re-organising itself to form deeper neural connections - ideas and concepts made more concrete. But we need time for the concrete to set. . So this explains why cramming is such a poor idea, yet still so prevalent in many learners - we are not taught the costs of doing so - i.e. no long term retention, no actually understanding, just surface level. . One other intersting aspect of sleep is that if we dream about the subjects we are studying, this can help to solidify that knowledge in what is known as chunking (discussed later). Hence, actively reading before bed can be very useful. . Exercise . Exercise is critically important to forming new synapses. . Procrastination, Memory, Practice . Procrastination . This is a problem we all face at one time or another… it took me 2 months before I worked up the courage to start blogging about my Machine Learning journey. . The reason this happens is that the when thinking about something we don’t want to do the Insular Cortex (the pain centre of the brain) reacts - therefore making us turn away from the problem to something more enjoyable. However, this enjoyment is only temporary and when we return to that oh-so terrible thing, we do it all over again. In my case, the potential of being judged, getting something wrong, or looking like a fool (all rooted in fear) was the cause. . So how do we tackle this and move forward? . The recommended technique in the course is to use Pomodoro - i.e. 25 minutes focused, hard work and then a 5 minute break with a reward (music, chocolate - a deeper chocolate addiction here I come) repeated over the course of the day. In this way we break down the unapproachable turd-sandwich into a smaller, more manageable slice of smelliness. . Interestingly, once we started working on it - that neural discomfort tends to reduce. So what was all the fuss about? . Memory . There are two principal parts to memory: Working and Long-Term. . In Working memory it appears as if we have about 4 “slots” available to us at any one time… not much! Working memory uses “chunks” whereby similar items are grouped together. The analogy used in the course is that it’s like an inefficient mental blackboard, where items can easily get wiped away. . In Long-Term memory, we can have billions of items, however, in the massive distributed storage warehouse of our brain. In order to retain access though, we need to keep retracting our steps to find it. This is where active recall is critically important in re-enforcing the neural pathways. . So why is our working memory so poor? To answer that, there’s an evolutionary reason, explained brilliantly by these lab tests. So much for “monkey mind” …: . https://www.youtube.com/watch?v=nTgeLEWr614 . In terms of memory tips and tricks, this is definitely Jim Kwik’s wheelhouse - he has some phenomenal tips for memory, one of which is: . TIP - Turn Into Picture - we have an innately visual memory - use it! See the Loci Method, for one. | . Practice Makes Permanent . We’ve all heard the old adage “Practice Makes Perfect” - but this is slightly misleading - if we do something, for however long, in an unfocused, slapdash manner… it ain’t going to be perfect. It’s going to be permanent. So, right practice is crucial. . In abstract subjects, with a lot of technical content, such as maths and science, it is critical to practice with the ideas in order to ingrain them more permanently - no non-genius ever sat down and solved a partial differential equation without knowing differential calculus and then building on top of it, for example. . As a side note: I cannot recommended 3blue1brown enough if you want a crystal clear, tangible understanding of even hard-to-grasp maths concepts . To make concepts concrete, we therefore need to follow some simple steps: . Study hard (Focus Mode) | Take a break (Diffuse Mode) | Repeat | . Spaced Repetition . Spaced repetition is an extremely effective way of building those synaptic connections. The spacing allows these neural pathways to form and be better consolidated. Again, the brai n needs time and repetition for true retainment. For example, we could follow the following study routine for a subject: . Monday Tuesday Wednesday Thursday Friday Saturday Sunday . Study | Study | Study | Rest | Study | Rest | Study | .",
          "url": "https://mikful.github.io/mike-blog/drafts/Learning-How-To-Learn-Part-1.html",
          "relUrl": "/drafts/Learning-How-To-Learn-Part-1.html",
          "date": ""
      }
      
  

  
      ,"page2": {
          "title": "About Me",
          "content": "Hi, I’m Mike and I have a blog. Welcome. .",
          "url": "https://mikful.github.io/mike-blog/about/",
          "relUrl": "/about/",
          "date": ""
      }
      
  

  

  
  

  

  
  

  

  
  

  
  

  
  

  
      ,"page11": {
          "title": "",
          "content": "Sitemap: {{ “sitemap.xml” | absolute_url }} | .",
          "url": "https://mikful.github.io/mike-blog/robots.txt",
          "relUrl": "/robots.txt",
          "date": ""
      }
      
  

}